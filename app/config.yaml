name: "MPPT Modbus MQTT Poller"
version: "2.0.0"
slug: "mppt_modbus_mqtt_poller"
description: "透過 Modbus gateway 讀取 MPPT 資料並發佈到 MQTT，提供給 Home Assistant 使用。"
url: "https://github.com/loveflee/ha-mppt-modbus-addon"
documentation: "https://github.com/loveflee/ha-mppt-modbus-addon"

arch:
  - amd64
  - armv7
  - aarch64

startup: services
boot: auto
init: false

# ✅ Home Assistant UI 預設值（會寫入 /data/options.json）
options:
  debug: false

  modbus:
    host: "modbus gateway ip"
    port: 502
    unit_ids: [1, 2, 3, 4, 5]
    timeout: 3.0
    retry_delay: 2.0

  mqtt:
    broker: "core-mosquitto"
    port: 1883
    username: "user"
    password: "password"
    discovery_prefix: "homeassistant"
    node_id: "wifi01"
    device_name: "ampinvt_mppt"

polling:
  poll_interval: 3           # 輪詢休息時間 (秒)
  delay_between_units: 0.5   # 設備間隔 (秒)


# ✅ HA UI 驗證規則（⚠️ 結構必須與 options 完全一致）
schema:
  debug: bool

  modbus:
    host: str
    port: int
    unit_ids: str
    timeout: float
    retry_delay: float

  mqtt:
    broker: str
    port: int
    username: str
    password: password
    discovery_prefix: str
    node_id: str
    device_name: str

  polling:
    poll_interval: int
    delay_between_units: float

# ✅ 掛載資料夾
map:
  - config:rw
  - share:rw
  - ssl:ro

# ✅ 不主動開 Port（由內部程式對外連線）
ports: {}
