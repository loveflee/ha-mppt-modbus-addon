name: "MPPT Modbus MQTT Poller"
version: "1.0.0"
slug: "mppt_modbus_mqtt_poller"
description: "透過 Modbus gateway 讀取 MPPT 資料並發佈到 MQTT，提供給 Home Assistant 使用。"
arch:
  - amd64
  - armv7
  - aarch64
startup: services          # 跟隨 HA 服務啟動
boot: auto                 # HA 開機時自動啟動

# ✅ 可以在 HA UI 修改的參數（會寫到 /data/options.json）
options:
  modbus_host: "modbus_gatway_ip"   # 串口伺服器 / MPPT Modbus TCP Server IP
  modbus_port: 502                # Modbus TCP port

  mqtt_host: "homeassistant.local"      # MQTT Broker IP（通常就是 HA 的 IP）
  mqtt_port: 1883
  mqtt_username: "add new user in ha"
  mqtt_password: "only Local network can login"

  slave_ids: "1,2,3,4,5"          # 要輪詢的 MPPT Slave IDs (逗號分隔字串)
  poll_interval_seconds: 20       # 輪詢間隔秒數
  device_delay_ms: 500            # 每台設備間隔，毫秒

  node_id: "wifi01"               # 在 HA 中當作此 Node 的識別
  module_name: "mppt"             # module 名，方便未來擴充

  latitude: 24.15                 # 位置，用於日出/日落等邏輯（如有）
  longitude: 120.67

# ✅ options 型別定義（HA UI 驗證用）
schema:
  modbus_host: str
  modbus_port: int
  mqtt_host: str
  mqtt_port: int
  mqtt_username: str
  mqtt_password: str
  slave_ids: str
  poll_interval_seconds: int
  device_delay_ms: int
  node_id: str
  module_name: str
  latitude: float
  longitude: float

# 不用 environment，run.sh 會自己讀 /data/options.json
map:
  - config:rw
  - share:rw
  - ssl:ro

ports: {}
